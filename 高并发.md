## 线程安全性

定义:当多个线程访问某个类时.不管运行时环境采用何种调度方式或者这些进程将如何交替执行
,并且在主调代码中不需要任何额外的同步或协同,这个类都能表现出正确的行为,那么就称这个类是线程安全的


原子性:提供了互斥访问,同一时刻只能有一个线程来对它进行操作

可见性:一个线程对主内存的修该可以及时的被其他线程观察到

有序性:一个线程观察其他线程中的指令执行顺序,由于指令重排序的存在,该观察结果一般会杂乱无章

原子性 - Atomic包
* AtomicXXX:CAS,unsafe.compareAndSwapInt

* AtomicLong,LongAdder

* AtomicReference,AtomicReferenceFiledUpdater

* AtomicStampReference:CAS 的ABA问题


原子性 - 对比
* synchronize:不可中断锁,适合竞争不激烈,可读性好
* Lock:可中断锁，多样化同步,竞争激烈时能维持常态
* Atomic:竞争激烈时能维持常态,比Lock性能好;只能同步一个值

可见性
导致共享变量在线程间不可见的原因
* 线程交叉执行
* 重排序结合线程交叉执行
* 共享变量更新后的值没有在工作内存与主存间及时更新

可见性-synchronize
JMM关于synchronize的两条规定:
* 线程解锁前,必须把共享变量的最新值刷新到主内存
* 线程加锁时,将清空工作内存中共享变量的值,从而使用共享变量时需要从主内存中重新读取最新的值